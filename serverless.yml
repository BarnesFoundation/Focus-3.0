service: focus-application

provider:
    name: aws
    runtime: nodejs14.x
    region: us-east-1
    timeout: 900
    memorySize: 3008

    # Accept stage from command line, defaults to dev
    # - Should be EITHER prod or dev
    stage: ${opt:stage, 'dev'}

resources:
    Conditions:
        # Determine if deployment is for Production
        IsProduction:
            Fn::Equals:
                - ${opt:stage}
                - prod

functions:
    server:
        handler: dist/server/handler.server
        events:
            - http: ANY /
            - http: "ANY /{proxy+}"

            # For our CRON jobs, we only want to deploy the schedules
            # in our Production deployment stage

            - schedule:
                  Condition: IsProduction
                  name: CRON_ElasticSearchSyncJob
                  description: "An event scheduled to run the ElasticSearchSyncJob once each day"
                  rate: rate(1 day)
                  enabled: true
                  input:
                      path: "/api/job/ElasticSearchSyncJob"
                      httpMethod: "POST"

            - schedule:
                Condition: IsProduction
                name: CRON_BookmarkDeliveryJob
                description: "An event scheduled to run the BookmarkDeliveryJob once every 3 hours"
                rate: rate(3 hours)
                enabled: true
                input:
                    path: "/api/job/BookmarkDeliveryJob"
                    httpMethod: "POST"

            - schedule:
                Condition: IsProduction
                name: CRON_StoryDeliveryJob
                description: "An event scheduled to run the StoryDeliveryJob once every 3 hours"
                rate: rate(3 hours)
                enabled: true
                input:
                    path: "/api/job/StoryDeliveryJob"
                    httpMethod: "POST"

            - schedule:
                Condition: IsProduction
                name: CRON_StorySyncJob
                description: "An event scheduled to run the StorySyncJob once each day"
                rate: rate(1 day)
                enabled: true
                input:
                    path: "/api/job/StorySyncJob"
                    httpMethod: "POST"

            - schedule:
                Condition: IsProduction
                name: CRON_SessionClearJob
                description: "An event scheduled to run the SessionClearJob once every 3 days"
                rate: rate(3 days)
                enabled: false
                input:
                    path: "/api/job/SessionClearJob"
                    httpMethod: "POST"

package:
    patterns:
        - "!./**"
        - "dist/**"
        - "package.json"
        - "node_modules/**"
